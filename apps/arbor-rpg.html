<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ArborQuest ‚Äì Arborist Training Game</title>

<style>
  body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: #223822;
  }

  #game {
    max-width: 520px;
    margin: .5vh auto;
    background: #5c8e81;
    color: #fff;
    border-radius: 12px;
    padding: .75rem;
    border: 1px solid #fff;
    box-shadow: 0 0px 27px rgba(255, 245, 221, 0.45);
  }

  h1 { text-align:center; color:#fff; margin-top:0; font-size: clamp(1.2rem, 3.5vmin, 3rem);}
  h2 {text-align: center; margin: 0rem;}

  #stats, #controls, #enemyStats {
    border: 1px solid #2f4f2f;
    padding: 8px;
    margin: .5rem auto;
    border-radius: 8px;
    line-height: 1.3;
    word-spacing: .75rem;
    text-align: center;
  }

  .stat { padding-right:10px; font-size:0.9rem; }

  #enemyStats {
    display:none;
    background:#5b1e1e;
    color:#fff;
  }

  #visualizer {
    border: 1px solid #2f4f2f;
    border-radius: 8px;
    aspect-ratio: 16/9;
    padding: 8px;
    margin-bottom: 8px;
    background-color: #222;
  }

  #visualizer-img {
    width: 100%;
    margin-bottom: 0;
  }

  #text {
    background:#2f4f2f;
    color:#fff;
    padding: 1rem;
    min-height:50px;
    border-radius: 0px 0px 8px;
    white-space:pre-line;
    margin-top: 0;
  }

  button {
    width:100%;
    margin:4px 0;
    padding:10px;
    font-size:1rem;
    cursor:pointer;
    background:linear-gradient(#beb28d,#574b2f);
    border:2px solid #543f0e;
    border-radius:8px;
    color: #fff;
  }

  button:active { transform:scale(0.98); }

  footer {
    text-align:center;
    font-size:0.5rem;
    opacity:0.7;
    margin-top: .5rem;
  }
</style>
</head>

<body>
<div id="game">
  <h1 style="display: none;">üå≥üå≤ ArborQuest üå≤üå≥</h1>

  <div id="visualizer">
    <img id="visualizer-img" src="./arbor-quest-imgs/start-menu-01.png"></img>
    <div id="text"></div>
  </div>

  <div id="stats">
    XP: <strong id="xpText">0</strong>
    Health: <strong id="healthText">100</strong>
    Gold: <strong id="goldText">50</strong><br>
    Arboriculture: <strong id="arbText">0</strong>
    Safety: <strong id="safetyText">0</strong>
  </div>

  <div id="enemyStats">
    Enemy: <strong id="enemyName"></strong>
    Health: <strong id="enemyHealth"></strong>
  </div>

  

  <div id="controls">
    <button id="button1">Begin</button>
    <button id="button2">‚Äî</button>
    <button id="button3">‚Äî</button>
  </div>

<footer>Abundant Life Land & Tree ¬∑ Formation through knowledge</footer>
</div>

<script>
/* ===== Player ===== */
let player = {
  xp: 0,
  health: 100,
  gold: 50,
  currentWeapon: 0,
  skills: { arboriculture: 0, safety: 0 },
  streak: 0
};

let fighting = null;
let enemyHealth = 0;
let currentQuestion = null;

/* ===== DOM ===== */
const b1 = document.getElementById("button1");
const b2 = document.getElementById("button2");
const b3 = document.getElementById("button3");
const text = document.getElementById("text");

const xpText = document.getElementById("xpText");
const healthText = document.getElementById("healthText");
const goldText = document.getElementById("goldText");
const arbText = document.getElementById("arbText");
const safetyText = document.getElementById("safetyText");

const enemyStats = document.getElementById("enemyStats");
const enemyName = document.getElementById("enemyName");
const enemyHealthText = document.getElementById("enemyHealth");

/* ===== Weapons ===== */
const weapons = [
  { name:"Field Notebook", power:5 },
  { name:"ISA Study Guide", power:25 },
  { name:"ANSI A300", power:50 },
  { name:"Wisdom & Experience", power:100 }
];

/* ===== Enemies ===== */
const enemies = [
  { name:"Confusion", level:2, health:25, type:"arb" },
  { name:"Bad Practices", level:7, health:60, type:"arb" },
  { name:"Unsafe Work Site", level:8, health:70, type:"safety" },
  { name:"ISA Certification Exam", level:20, health:300, type:"all" }
];

/* ===== Study Prompts ===== */
const studyPrompts = {
  arboriculture: [
    "Explain CODIT in your own words.",
    "Identify proper vs improper pruning cuts.",
    "Describe how soil compaction affects roots.",
    "Explain reduction vs thinning pruning.",
    "Find and observe a visible branch collar."
  ],
  safety: [
    "Review PPE required for chainsaw operation.",
    "Visualize an escape route before a cut.",
    "Explain why drop zones matter.",
    "Identify a common near-miss hazard.",
    "Explain how kickback occurs."
  ]
};

/* ===== Questions ===== */
const questions = {
  arb: [
    { q:"Topping is an acceptable pruning practice.", a:false },
    { q:"A branch collar should be preserved when pruning.", a:true },
    { q:"Soil compaction can reduce root oxygen.", a:true }
  ],
  safety: [
    { q:"Kickback occurs when the chain contacts wood at the tip.", a:true },
    { q:"PPE is optional for experienced climbers.", a:false },
    { q:"Drop zones help reduce ground crew risk.", a:true }
  ],
  all: [
    { q:"CODIT describes how trees compartmentalize decay.", a:true },
    { q:"ANSI A300 defines pruning standards.", a:true },
    { q:"Flush cuts improve wound closure.", a:false }
  ]
};

/* ===== Locations ===== */
const locations = [
  {
    buttons:["Visit Arborist's Grove","Enter Wild Wood","Face the Exam"],
    actions:[goGrove,goWood,fightExam],
    text:"You stand at the edge of a growing town."
  },
  {
    buttons:["Study Arboriculture","Study Safety","Return to Town"],
    actions:[studyArb,studySafety,goTown],
    text:"The Arborist's Grove is quiet and focused. This is a place of formation."
  },
  {
    buttons:["Face Confusion","Face Bad Practices","Face Unsafe Site"],
    actions:[()=>fightEnemy(0),()=>fightEnemy(1),()=>fightEnemy(2)],
    text:"The Wild Wood tests what you truly know."
  },
  {
    buttons:["True","False","Flee"],
    actions:[()=>answer(true),()=>answer(false),fleeFight],
    text:""
  },
  {
    buttons:["Return to Town","Return to Town","Return to Town"],
    actions:[goTown,goTown,goTown],
    text:"Understanding prevails."
  }
];

/* ===== Core ===== */
function update(loc){
  [b1,b2,b3].forEach((b,i)=>{
    b.innerText = loc.buttons[i];
    b.onclick = loc.actions[i];
  });
  text.innerText = loc.text;
}

function sync(){
  xpText.innerText = player.xp;
  healthText.innerText = player.health;
  goldText.innerText = player.gold;
  arbText.innerText = player.skills.arboriculture;
  safetyText.innerText = player.skills.safety;
}

function goTown(){
  enemyStats.style.display = "none";
  update(locations[0]);
}

function goGrove(){
  enemyStats.style.display = "none";
  update(locations[1]);
}

function goWood(){
  enemyStats.style.display = "none";
  update(locations[2]);
}

/* ===== Study (with prompts restored) ===== */
function study(category){
  const prompts = studyPrompts[category];
  const prompt = prompts[Math.floor(Math.random()*prompts.length)];
  const gain = 10 + Math.floor(Math.random()*6);

  player.xp += gain;
  player.skills[category] += 1;
  player.health += category === "safety" ? 12 : 6;
  player.streak += 1;

  unlockWeapon();
  sync();

  text.innerText =
    `üìò Study Task:\n${prompt}\n\n+${gain} XP\nStreak: ${player.streak}`;
}

function studyArb(){ study("arboriculture"); }
function studySafety(){ study("safety"); }

/* ===== Weapons ===== */
function unlockWeapon(){
  if(player.xp >= 40) player.currentWeapon = 1;
  if(player.xp >= 100) player.currentWeapon = 2;
  if(player.xp >= 200) player.currentWeapon = 3;
}

/* ===== Combat ===== */
function fightEnemy(i){
  fighting = i;
  enemyHealth = enemies[i].health;
  enemyStats.style.display = "block";
  nextQuestion();
}

function fightExam(){ fightEnemy(3); }

function nextQuestion(){
  const enemy = enemies[fighting];
  const pool = questions[enemy.type];
  currentQuestion = pool[Math.floor(Math.random()*pool.length)];

  enemyName.innerText = enemy.name;
  enemyHealthText.innerText = enemyHealth;

  update(locations[3]);
  text.innerText = "‚ùì " + currentQuestion.q;
}

function answer(choice){
  const enemy = enemies[fighting];

  if(choice === currentQuestion.a){
    let skillBonus =
      enemy.type==="safety" ? player.skills.safety*3 :
      enemy.type==="arb" ? player.skills.arboriculture*3 :
      (player.skills.arboriculture + player.skills.safety)*2;

    const damage = weapons[player.currentWeapon].power + skillBonus;
    enemyHealth -= Math.floor(damage);
    text.innerText = "Correct.\nYou apply knowledge effectively.";
  } else {
    const hit = enemy.level * 6;
    player.health -= hit;
    text.innerText = "Incorrect.\nThe challenge pushes back.";
  }

  sync();
  enemyHealthText.innerText = enemyHealth;

  if(player.health <= 0){
    enemyStats.style.display = "none";
    goTown();
  }
  else if(enemyHealth <= 0){
    player.xp += enemy.level*3;
    player.gold += enemy.level*4;
    sync();
    enemyStats.style.display = "none";
    update(locations[4]);
  }
  else {
    setTimeout(nextQuestion, 800);
  }
}

function fleeFight(){
  enemyStats.style.display = "none";
  goTown();
}

/* ===== Start ===== */
goTown();
</script>
</body>
</html>
