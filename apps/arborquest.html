<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ArborQuest ‚Äì Arborist Training Game</title>

<style>
  body {
    margin: 0;
    font-family: Arial, Helvetica, sans-serif;
    background: #223822;
  }

  #game {
    max-width: 520px;
    margin: .5vh auto;
    background: #5c8e81;
    color: #fff;
    border-radius: 12px;
    padding: .75rem;
    border: 1px solid #fff;
    box-shadow: 0 0px 27px rgba(255, 245, 221, 0.45);
  }

  h1 { text-align:center; color:#fff; margin-top:0; font-size: clamp(1.2rem, 3.5vmin, 3rem);}
  h2 {text-align: center; margin: 0rem;}

  #stats, #controls, #enemyStats {
    border: 1px solid #2f4f2f;
    padding: 8px;
    margin: .5rem auto;
    border-radius: 8px;
    line-height: 1.3;
    word-spacing: .75rem;
    text-align: center;
  }

  .stat { padding-right:10px; font-size:0.9rem; }

  #enemyStats {
    display:none;
    background:#5b1e1e;
    color:#fff;
  }

  #visualizer {
    border: 1px solid #2f4f2f;
    border-radius: 8px;
    aspect-ratio: 16/9;
    padding: 8px;
    margin-bottom: 8px;
    background-color: #222;
  }

  #visualizer-img {
    width: 100%;
    margin-bottom: 0;
  }

  #text {
    background:#2f4f2f;
    color:#fff;
    padding: 1rem;
    min-height:50px;
    border-radius: 0px 0px 8px;
    white-space:pre-line;
    margin-top: 0;
  }

  button {
    width:100%;
    margin:4px 0;
    padding:10px;
    font-size:1.05rem;
    font-weight: 400;
    cursor:pointer;
    background:radial-gradient(#ecc799,#61482c);
    border:2px solid #372807;
    border-radius: 2rem;
    color: #372807;
  }

  button:active { transform:scale(0.98); }

  footer {
    text-align:center;
    font-size:0.5rem;
    opacity:0.7;
    margin-top: .5rem;
  }
</style>
</head>

<body>
<div id="game">
  <h1 style="display: none;">üå≥üå≤ ArborQuest üå≤üå≥</h1>

  <div id="visualizer">
    <img id="visualizer-img" src="./arbor-quest-imgs/start-menu-01.png"></img>
    <div id="text"></div>
  </div>

  <div id="stats">
    XP: <strong id="xpText">0</strong>
    Health: <strong id="healthText">100</strong>
    Gold: <strong id="goldText">50</strong><br>
    Arboriculture: <strong id="arbText">0</strong>
    Safety: <strong id="safetyText">0</strong>
  </div>

  <div id="enemyStats">
    Enemy: <strong id="enemyName"></strong>
    Health: <strong id="enemyHealth"></strong>
  </div>

  

  <div id="controls">
    <button id="button1">Begin</button>
    <button id="button2">‚Äî</button>
    <button id="button3">‚Äî</button>
  </div>

<footer>Abundant Life Land & Tree ¬∑ Formation through knowledge</footer>
</div>

<script>
/* ===== Player ===== */
let player = {
  xp: 0,
  health: 100,
  gold: 50,
  currentWeapon: 0,
  skills: { arboriculture: 0, safety: 0 },
  streak: 0
};

let fighting = null;
let enemyHealth = 0;
let currentQuestion = null;

/* ===== DOM ===== */
const b1 = document.getElementById("button1");
const b2 = document.getElementById("button2");
const b3 = document.getElementById("button3");
const text = document.getElementById("text");

const xpText = document.getElementById("xpText");
const healthText = document.getElementById("healthText");
const goldText = document.getElementById("goldText");
const arbText = document.getElementById("arbText");
const safetyText = document.getElementById("safetyText");

const enemyStats = document.getElementById("enemyStats");
const enemyName = document.getElementById("enemyName");
const enemyHealthText = document.getElementById("enemyHealth");

/* ===== Weapons ===== */
const weapons = [
  { name:"Field Notebook", power:5 },
  { name:"ISA Study Guide", power:25 },
  { name:"ANSI A300", power:50 },
  { name:"Wisdom & Experience", power:100 }
];

/* ===== Enemies ===== */
const enemies = [
  { name:"Confusion", level:2, health:25, type:"arb" },
  { name:"Bad Practices", level:7, health:60, type:"arb" },
  { name:"Unsafe Work Site", level:8, health:70, type:"safety" },
  { name:"ISA Certification Exam", level:20, health:300, type:"all" }
];

/* ===== Study Prompts ===== */
const studyPrompts = {
  arboriculture: [
    "Explain CODIT in your own words, including the four walls and what they represent.",
    "Identify proper vs improper pruning cuts on a real tree or image.",
    "Describe how soil compaction affects root respiration and water infiltration.",
    "Explain the difference between reduction, thinning, and raising cuts.",
    "Find and observe a visible branch collar and branch bark ridge.",
    "Explain why flush cuts are harmful to tree health.",
    "Describe the role of leaves in energy production and storage.",
    "Explain how trees respond biologically to wounding.",
    "Identify signs of poor past pruning and predict long-term outcomes.",
    "Explain the difference between heartwood and sapwood.",
    "Describe how species differences affect pruning decisions.",
    "Explain why topping is considered a harmful practice.",
    "Observe a tree with included bark and explain why it is structurally weak.",
    "Explain how branch aspect ratio influences attachment strength.",
    "Describe how roots actually spread compared to common myths.",
    "Explain how soil texture differs from soil structure.",
    "Identify a tree showing stress and list possible contributing factors.",
    "Explain why timing matters when pruning certain species.",
    "Describe how decay spreads differently in ring-porous vs diffuse-porous trees.",
    "Explain the concept of target pruning.",
    "Identify epicormic growth and explain why it forms.",
    "Explain how pruning affects a tree‚Äôs energy balance.",
    "Describe the purpose of structural pruning on young trees.",
    "Explain why lion-tailing is harmful.",
    "Observe natural branch shedding and relate it to CODIT.",
    "Explain the difference between clearance pruning and crown reduction.",
    "Describe how girdling roots form and why they are dangerous.",
    "Explain how improper mulch application affects root systems.",
    "Identify a tree species and name one pruning consideration specific to it.",
    "Explain how storm damage differs from poor pruning damage.",
    "Describe how decay columns can affect load-bearing capacity.",
    "Explain the importance of pruning dose (percentage removed).",
    "Explain how trees adapt growth to prevailing wind.",
    "Observe branch spacing and explain its relevance to structure.",
    "Explain why pruning mature trees requires restraint.",
    "Describe how sunlight availability shapes crown architecture.",
    "Explain how soil moisture extremes stress trees.",
    "Explain what a clearly defined pruning objective entails.",
    "Explain how tree age affects wound closure.",
    "Describe how improper staking can weaken trees.",
    "Explain the role of mycorrhizal fungi in tree health."
  ],

  safety: [
    "Review PPE required for chainsaw operation and explain why each item matters.",
    "Visualize and identify two escape routes before a cut.",
    "Explain why drop zones are critical for ground crew safety.",
    "Identify a common near-miss hazard you‚Äôve seen or could imagine.",
    "Explain how chainsaw kickback occurs and how to prevent it.",
    "Describe proper chainsaw starting procedures.",
    "Explain the difference between reactive and proactive safety.",
    "Identify overhead hazards before beginning work.",
    "Explain why clear communication is essential between climber and ground crew.",
    "Describe proper body positioning when making a cut.",
    "Explain why fatigue increases accident risk.",
    "Identify weather conditions that should delay or stop work.",
    "Explain the importance of maintaining three points of contact.",
    "Describe how improper rigging can endanger workers and property.",
    "Explain why complacency develops in experienced workers.",
    "Identify proper work zone setup on a residential street.",
    "Explain why chainsaw chain sharpness is a safety issue.",
    "Describe how poor footing increases risk aloft.",
    "Explain the role of a designated safety coordinator on site.",
    "Identify potential electrical hazards near trees.",
    "Explain how situational awareness reduces accidents.",
    "Describe how to safely approach a hung-up limb.",
    "Explain why rushing increases injury likelihood.",
    "Identify common tripping hazards on a job site.",
    "Explain why clear job briefings matter before climbing.",
    "Describe how proper tool storage improves safety.",
    "Explain why hearing protection is often neglected and why it matters.",
    "Identify signs that a job is exceeding current skill limits.",
    "Explain how emergency planning improves outcomes.",
    "Describe how chainsaw bar length affects control.",
    "Explain why ground crew positioning matters during cuts.",
    "Identify unsafe behaviors that become normalized over time.",
    "Explain how miscommunication leads to near misses.",
    "Describe how to recognize when to stop and reassess a plan.",
    "Explain why PPE is not a substitute for good judgment.",
    "Identify hazards created by poor housekeeping on site.",
    "Explain why eye protection is critical even for short tasks.",
    "Describe how proper hydration affects safety.",
    "Explain why every cut should be intentional.",
    "Identify one safety habit you want to strengthen this week."
  ]
};


/* ===== Questions ===== */
const questions = {
  arb: [
    { q: "Topping is an acceptable pruning practice.", a: false },
    { q: "A branch collar should be preserved when pruning.", a: true },
    { q: "Soil compaction can reduce root oxygen availability.", a: true },
    { q: "Flush cuts help trees seal wounds more effectively.", a: false },
    { q: "CODIT explains how trees resist the spread of decay.", a: true },
    { q: "Lion-tailing improves branch strength.", a: false },
    { q: "Reduction cuts are used to decrease overall crown size while maintaining structure.", a: true },
    { q: "Thinning cuts shorten branches to reduce weight.", a: false },
    { q: "Epicormic shoots often form in response to stress or heavy pruning.", a: true },
    { q: "Trees heal damaged tissue in the same way animals do.", a: false },
    { q: "Branch bark ridges indicate the angle and strength of branch attachment.", a: true },
    { q: "Girdling roots can compromise a tree‚Äôs vascular system.", a: true },
    { q: "More pruning always leads to faster growth.", a: false },
    { q: "Target pruning refers to cutting just outside the branch collar.", a: true },
    { q: "Mature trees tolerate heavy pruning better than young trees.", a: false },
    { q: "Structural pruning is most effective when performed on young trees.", a: true },
    { q: "Heartwood plays a primary role in water transport.", a: false },
    { q: "Sapwood is responsible for transporting water and nutrients.", a: true },
    { q: "Included bark weakens branch attachments.", a: true },
    { q: "Storm damage and poor pruning create similar wound responses in trees.", a: false },
    { q: "Mycorrhizal fungi can improve root nutrient uptake.", a: true },
    { q: "Pruning dose refers to the percentage of live crown removed.", a: true },
    { q: "All tree species respond to pruning in the same way.", a: false },
    { q: "Mulch piled against a trunk can lead to decay and root problems.", a: true },
    { q: "Ring-porous and diffuse-porous trees compartmentalize decay differently.", a: true }
  ],

  safety: [
    { q: "Kickback occurs when the chain contacts wood at the guide bar tip.", a: true },
    { q: "PPE is optional for experienced climbers.", a: false },
    { q: "Drop zones help reduce risk to ground workers.", a: true },
    { q: "Fatigue can significantly increase the risk of accidents.", a: true },
    { q: "Chainsaws are safest when started while held in mid-air.", a: false },
    { q: "Clear communication between climber and ground crew improves safety.", a: true },
    { q: "Weather conditions have little impact on job-site safety.", a: false },
    { q: "Escape routes should be planned before making a cut.", a: true },
    { q: "Dull chains are safer than sharp chains.", a: false },
    { q: "Maintaining situational awareness helps prevent accidents.", a: true },
    { q: "Improper footing aloft increases fall risk.", a: true },
    { q: "Experience alone eliminates the need for job briefings.", a: false },
    { q: "Electrical hazards may exist even without visible power lines.", a: true },
    { q: "Rushing a job can increase injury likelihood.", a: true },
    { q: "Three points of contact improve stability when climbing.", a: true },
    { q: "Near misses should be ignored if no one is hurt.", a: false },
    { q: "Proper tool storage reduces trip hazards.", a: true },
    { q: "Hearing protection is unnecessary for short chainsaw use.", a: false },
    { q: "Ground crew positioning affects safety during cutting operations.", a: true },
    { q: "Complacency is a common cause of workplace accidents.", a: true },
    { q: "Emergency planning is only needed on large jobs.", a: false },
    { q: "Clear work zone boundaries improve public safety.", a: true },
    { q: "Poor housekeeping can create hazards on site.", a: true },
    { q: "Stopping to reassess a plan can prevent accidents.", a: true },
    { q: "PPE replaces the need for good judgment.", a: false }
  ],

  all: [
    { q: "CODIT describes how trees compartmentalize decay.", a: true },
    { q: "ANSI A300 defines pruning standards.", a: true },
    { q: "Flush cuts improve wound closure.", a: false },
    { q: "Good arboriculture balances tree health and human safety.", a: true },
    { q: "Improper pruning can increase long-term risk and maintenance needs.", a: true },
    { q: "Safety practices and tree biology are unrelated.", a: false },
    { q: "Understanding tree structure can improve rigging and cutting decisions.", a: true },
    { q: "Most arborist accidents are caused by unpredictable tree behavior.", a: false },
    { q: "Planning before cutting reduces both biological and safety risks.", a: true },
    { q: "Experience alone guarantees good decision-making.", a: false },
    { q: "ISA certification emphasizes both knowledge and safety.", a: true },
    { q: "Proper pruning reduces the likelihood of future failures.", a: true },
    { q: "Trees and workers benefit from intentional, well-planned actions.", a: true },
    { q: "Ignoring standards has no long-term consequences.", a: false },
    { q: "High-quality arboriculture requires continuous learning.", a: true }
  ]
};


/* ===== Locations ===== */
const locations = [
  {
    buttons:["Visit Arborist's Grove","Enter Wild Wood","Face the Exam"],
    actions:[goGrove,goWood,fightExam],
    text:"You stand at the edge of a growing town."
  },
  {
    buttons:["Study Arboriculture","Study Safety","Return to Town"],
    actions:[studyArb,studySafety,goTown],
    text:"The Arborist's Grove is quiet and focused. This is a place of formation."
  },
  {
    buttons:["Face Confusion","Face Bad Practices","Face Unsafe Site"],
    actions:[()=>fightEnemy(0),()=>fightEnemy(1),()=>fightEnemy(2)],
    text:"The Wild Wood tests what you truly know."
  },
  {
    buttons:["True","False","Flee"],
    actions:[()=>answer(true),()=>answer(false),fleeFight],
    text:""
  },
  {
    buttons:["Return to Town","Return to Town","Return to Town"],
    actions:[goTown,goTown,goTown],
    text:"Understanding prevails."
  }
];

/* ===== Core ===== */
function update(loc){
  [b1,b2,b3].forEach((b,i)=>{
    b.innerText = loc.buttons[i];
    b.onclick = loc.actions[i];
  });
  text.innerText = loc.text;
}

function sync(){
  xpText.innerText = player.xp;
  healthText.innerText = player.health;
  goldText.innerText = player.gold;
  arbText.innerText = player.skills.arboriculture;
  safetyText.innerText = player.skills.safety;
}

function goTown(){
  enemyStats.style.display = "none";
  update(locations[0]);
}

function goGrove(){
  enemyStats.style.display = "none";
  update(locations[1]);
}

function goWood(){
  enemyStats.style.display = "none";
  update(locations[2]);
}

/* ===== Study (with prompts restored) ===== */
function study(category){
  const prompts = studyPrompts[category];
  const prompt = prompts[Math.floor(Math.random()*prompts.length)];
  const gain = 10 + Math.floor(Math.random()*6);

  player.xp += gain;
  player.skills[category] += 1;
  player.health += category === "safety" ? 12 : 6;
  player.streak += 1;

  unlockWeapon();
  sync();

  text.innerText =
    `üìò Study Task:\n${prompt}\n\n+${gain} XP\nStreak: ${player.streak}`;
}

function studyArb(){ study("arboriculture"); }
function studySafety(){ study("safety"); }

/* ===== Weapons ===== */
function unlockWeapon(){
  if(player.xp >= 40) player.currentWeapon = 1;
  if(player.xp >= 100) player.currentWeapon = 2;
  if(player.xp >= 200) player.currentWeapon = 3;
}

/* ===== Combat ===== */
function fightEnemy(i){
  fighting = i;
  enemyHealth = enemies[i].health;
  enemyStats.style.display = "block";
  nextQuestion();
}

function fightExam(){ fightEnemy(3); }

function nextQuestion(){
  const enemy = enemies[fighting];
  const pool = questions[enemy.type];
  currentQuestion = pool[Math.floor(Math.random()*pool.length)];

  enemyName.innerText = enemy.name;
  enemyHealthText.innerText = enemyHealth;

  update(locations[3]);
  text.innerText = "‚ùì " + currentQuestion.q;
}

function answer(choice){
  const enemy = enemies[fighting];

  if(choice === currentQuestion.a){
    let skillBonus =
      enemy.type==="safety" ? player.skills.safety*3 :
      enemy.type==="arb" ? player.skills.arboriculture*3 :
      (player.skills.arboriculture + player.skills.safety)*2;

    const damage = weapons[player.currentWeapon].power + skillBonus;
    enemyHealth -= Math.floor(damage);
    text.innerText = "Correct.\nYou apply knowledge effectively.";
  } else {
    const hit = enemy.level * 6;
    player.health -= hit;
    text.innerText = "Incorrect.\nThe challenge pushes back.";
  }

  sync();
  enemyHealthText.innerText = enemyHealth;

  if(player.health <= 0){
    enemyStats.style.display = "none";
    goTown();
  }
  else if(enemyHealth <= 0){
    player.xp += enemy.level*3;
    player.gold += enemy.level*4;
    sync();
    enemyStats.style.display = "none";
    update(locations[4]);
  }
  else {
    setTimeout(nextQuestion, 800);
  }
}

function fleeFight(){
  enemyStats.style.display = "none";
  goTown();
}

/* ===== Start ===== */
goTown();
</script>
</body>
</html>
